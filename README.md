# Pollack_et_al_2024

# The statistical framework for generating boundary conditions for compound flood models

This directory contains MATLAB scripts used for estimating the return periods of compound flood drivers in coastal regions, focusing on the mixed populations (tropical cyclones (TCs) and non-tropical cyclones (non-TCs)). The methodology and results are detailed in the paper "[Funding rules that promote equity in climate adaptation outcomes](https://osf.io/preprints/osf/6ewmu)."

<br>

>Pollack, Adam & Santamaria-Aguilar, Sara & Maduwantha, Pravin & Keller, Klaus. (2024). Funding rules that promote equity in climate adaptation outcomes. 10.31219/osf.io/6ewmu.

<be>

## Overview of Scripts
**The input and output files are generated by the MATLAB scripts (except the raw data inputs). Under the "Input" files, the file name is given first following the format of the file**

### 1. Bias Correction
- **`Bias_Correction.m`**

**Description**: This script applies a bias correction to the rainfall data using quantile mapping. The method adjusts the hourly rainfall gauge data to match the basin-average rainfall values derived from the Analysis of Record for Calibration (AORC) data.-

**Input**:
- `Pr_Measured.mat`:- [date-time, hourly precipitation]
- `Pr_AORC.mat`:- [date-time, hourly precipitation]

**output**: 
- `Bias Corrected MS at {location}_With_AORC_of_GC.mat`:- [date-time, hourly precepitation]

 
### 2. Calculating accumulated rainfall 
- **`Creating_Accumulated_RF.m`**

**Description**: The script calculates the accumulated rainfall from 1 to 48 hours suing the hourly rainfall data.
    
**Input**: 
- `Bias Corrected MS at “location”_With_AORC_of_GC.mat`:- [date-time, hourly precipitation]

**output**:  
- `Hourly_accumulation_Bias_Corrected_RF_data_”location”.mat`:- [date-time, hourly accumulated Rf (nx48)]



   

### 3. 	Defining peak-over-threshold extreme events
- **`Scripts/Creating_POT_Extremes_NTR.m`**

**Description**: The script uses the Peak over threshold (POT) approach to define events over thresholds for non-tidal residuals (NTR).
Functions: ut_solv, ut_reconstr are needed and should be downloaded through U-tide package (https://www.mathworks.com/matlabcentral/fileexchange/46523-utide-unified-tidal-analysis-and-prediction-functions). The years with substantial data gaps are removed manually. 

**Input**:
- `Water level data` :- [date-time, hourly water levels]

**output**: 
- `POT_NTR_and_NTR_timeseries.mat` :- structure[NTR.POT.WL_raw.Tide.MovA_WL.Threshold]


- **`Scripts/Creating_POT_Extremes_RF.m`**

**Description**: The script uses the Peak over threshold (POT) approach to define events over thresholds for basin average rainfall. The code calculates the threshold exceedances for rainfall accumulation times from 1 to 48.

**Input**:
- `Hourly_accumulation_Bias_Corrected_RF_data_”location”.mat`:- [date-time, hourly accumulated Rf (nx48)]

**output**: 
- `POT_Events_for_each_RF_Accumulation_time.mat`: -structure[events[POT.Threshold]




### 4. Two-way sampling
4. 1 Conditioned on NTR

**Description**: The script finds the maximum accumulated rainfall (for all the hourly accumulations from 1 to 48) within a given time window around the selected POT event when conditioning NTR.
- **`Scripts/Sampling_Con_NTR.m`**

**Input**:
- `Hourly_accumulation_Bias_Corrected_RF_data_”location”.mat`:- [date-time, hourly accumulated Rf (nx48)]
- `POT_NTR_and_NTR_timeseries.mat`:- structure[NTR.POT.WL_raw.Tide.MovA_WL.Threshold]

**output**:  
- `Maximum_RF_events_for_each_POT_NTR.ma`:-structure[Acumulation[Time_NTR.POT_NTR.Time_RF.Max_RF]

4. 2 Conditioned on RF

**Description**: The script finds the maximum NTR (for all the selected accumulation time) within a given time window around the selected POT event when conditioning RF.
- **`Scripts/Sampling_Con_RF.m`**

**Input**:
- `POT_NTR_and_NTR_timeseries.mat`:- structure[NTR.POT.WL_raw.Tide.MovA_WL.Threshold]
- `POT_Events_for_each_RF_Accumulation_time.mat`: -structure[events[POT.Threshold]


**output**: 
- `Maximum_NTR_events_for_each_POT_RF_for_”Selected_accumulation_time”_RF_acc.mat`:-structure [Time_NTR.Max_NTR.Time_RF.POT_RF]

## 5. Stratification
**Description**: The two conditional samples are stratified into two sets as: 1. The events caused by Tropical cyclones 2. The events that were not caused by tropical cyclones. The Hurdat 2  data set is used to identify the events induced by tropical cyclones.
    
5.1 Conditioned on NTR
- **`Scripts/Stratification_Con_NTR.m`**

**Input**: 
- `Maximum_RF_events_for_each_POT_NTR.mat`:-structure[Acumulation[Time_NTR.POT_NTR.Time_RF.Max_RF]
- `Cyclone_Track_data_from_1850.mat`:- [date-time, lat, lon, speed, distance from the city]

**output**: 
- `TC_events_conditioning_POT_NTR.mat`:- structure[event.[Time_NTR,NTR,Time_RF,RF]
- `ETC_events_conditioning_POT_NTR.mat`:- structure[event.[Time_NTR,NTR,Time_RF,RF]

5.2 Conditioned on RF
- **`Scripts/Stratification_Con_RF.m`**

**Input**:
- `Maximum_NTR_events_for_each_POT_RF_for_”Selected_accumulation_time”_RF_acc.mat`:-structure [Time_NTR.Max_NTR.Time_RF.POT_RF]
- `Cyclone_Track_data_from_1850.mat`:- [date-time, lat, lon, speed, distance from the city]

**output**: 
- `TC_events_conditioning_POT_RF.mat`:- structure[event.[Time_NTR,NTR,Time_RF,RF]
- `ETC_events_conditioning_POT_RF.mat`:- structure[event.[Time_NTR,NTR,Time_RF,RF]



## 6. Return period estimation with confidence interval

**Description**: The stratified conditional samples are fitted with Generalized Pareto Distributions to estimate the return periods: 1. The following "XXX_main.mat" program is used for generating the scaled events based on the return periods calculated through the function "Uni_Return_level_calc_with_boostrap.mat". 
    
- **`Scripts/Univariate_event_generation_main.m`**
- **`Scripts/Uni_Return_level_calc_with_bootstrap.m`**


**Input**: 
- `n_sim` = number of Bootstrapping samples required [number]
- `ET_NTR` = vector of POT Non-TC events conditioned on NTR [time_NTR, NTR, Time_RF,RF]
- `TC_NTR` = vector of POT TC events conditioned on NTR [time_NTR, NTR,Time_RF,RF]
- `ET_RF` = vector of POT Non-TC events conditioned on RF [time_NTR, NTR,Time_RF,RF]
- `TC_RF` = vector of POT TC events conditioned on RF [time_NTR, NTR,Time_RF,RF]
- `Thres_NTR` = single numeric vector of NTR threshold
- `Thres_RF` = single numeric vector of RF threshold
- `n_years` = Total number of years
- `Q_RP` = Vector of Return periods of interest
- `l_b_NTR` = Lover bound of discretized NTR space for combining two populations;
- `U_b_NTR` = Upper bound of discretized NTR space for combining two populations;
- `l_b_R`F = Lover bound of discretized RF space for combining two populations;
- `U_b_RF` = Upper bound of discretized RF space for combining two populations;
- `RL_NTR`, - `RL_RF` = calculated combined return level vectors for a given return period in the vector Q_RP


**output**: 
- `RL_NTR_com.mat`:- combined return levels of NTR, for return periods from 0 to 500 in 0.1 interval
- `RL_RF_com.mat`:- combined return levels of RF, for return periods from 0 to 500 in 0.1 interval
- `RL_TC_NTR.mat`:- return levels of TC induced NTR, for return periods from 0 to 500 in 0.1 intervals, for each bootstrapped sample
- `RL_ETC_NTR.mat`:- return levels of non-TC induced NTR, for return periods from 0 to 500 in 0.1 intervals, for each bootstrapped sample
- `RL_TC_RF.mat`:- return levels of TC-induced RF, for return periods from 0 to 500 in 0.1 intervals, for each bootstrapped sample
- `RL_ETC_RF.mat`:- return levels of non-TC induced RF, for return periods from 0 to 500 in 0.1 intervals, for each bootstrapped sample
- `RP_NTR.mat`:- vector of return periods considered [1:0.1:500]
- `RP_RF.mat`:- vector of return periods considered [1:0.1:500]

- `Design_events_Cropped_Irene_.mat`:- structure[WL,RF,RP,Tide,NTR]
  
The Cropped events are used as boundary conditions for the compound flood model. 


